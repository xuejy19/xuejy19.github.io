---
title: æ¦‚ç‡åˆ†å¸ƒä¸­çš„è·ç¦»åº¦é‡
date: 2020-08-26 17:38:32 
tags: KLæ•£åº¦ï¼ŒJSæ•£åº¦ï¼Œæ¨åœŸæœºè·ç¦»
categories: ç»Ÿè®¡å­¦ä¹ 
mathjax: true
toc: true
---
åœ¨$k$è¿‘é‚»ç« èŠ‚ä¸­ï¼Œæˆ‘æ€»ç»“äº†åœ¨æ ·æœ¬ç©ºé—´ä¸­å¸¸ç”¨çš„ä¸¤ç§è·ç¦»åº¦é‡:$L_p$è·ç¦»ä»¥åŠé©¬æ°è·ç¦»ã€‚ä½†åœ¨ä¸€äº›æœºå™¨å­¦ä¹ ä»»åŠ¡ä¸­ï¼Œæˆ‘ä»¬æœŸæœ›èƒ½å¤Ÿå¾—åˆ°ä¸€ä¸ªåˆ†å¸ƒä¸ç›®æ ‡åˆ†å¸ƒå°½å¯èƒ½æ¥è¿‘ï¼Œè¿™ä¹Ÿå°±å¼•å‡ºäº†ä¸€ä¸ªæ–°çš„é—®é¢˜:
> å¦‚ä½•åº¦é‡ä¸¤ä¸ªæ¦‚ç‡åˆ†å¸ƒä¹‹é—´çš„è·ç¦»(å·®å¼‚ç¨‹åº¦)ï¼Ÿ

æœ¬æ–‡å°†ä»‹ç»ä¸€äº›å¸¸è§çš„æ¦‚ç‡åˆ†å¸ƒä¹‹é—´çš„è·ç¦»åº¦é‡ï¼ŒæŒ‰ç…§ä»¥ä¸‹ç»“æ„ç»„ç»‡:
- ä¿¡æ¯é‡ä¸ç†µ
- KLæ•£åº¦(ç›¸å¯¹ç†µ)
- äº¤å‰ç†µ
- JSæ•£åº¦
- æ¨åœŸæœºç†è®ºä¸Wassersteinè·ç¦»
<!--more-->

### ä¿¡æ¯é‡ä¸ç†µ 
#### ä¿¡æ¯é‡
ä»»ä½•äº‹ä»¶éƒ½ä¼šæ‰¿è½½ç€ä¸€å®šçš„ä¿¡æ¯é‡ï¼ŒåŒ…æ‹¬å·²ç»å‘ç”Ÿçš„äº‹ä»¶å’Œæœªå‘ç”Ÿçš„äº‹ä»¶ï¼Œåªæ˜¯å®ƒä»¬æ‰¿è½½çš„ä¿¡æ¯é‡æœ‰æ‰€ä¸åŒï¼š
> ğŸŒ°ï¼šå¯¹äºä¸¤ä¸ªäº‹ä»¶ï¼šæ˜¨å¤©ä¸‹é›¨ä¸æ˜å¤©ä¸‹é›¨ã€‚æ˜¨å¤©ä¸‹é›¨è¿™ä¸ªäº‹ä»¶ï¼Œå› ä¸ºå·²ç»å‘ç”Ÿï¼Œæ—¢å®šäº‹å®ï¼Œé‚£ä¹ˆå®ƒçš„ä¿¡æ¯é‡å°±ä¸º0ï¼›è€Œå¯¹äºæ˜å¤©ä¼šä¸‹é›¨è¿™ä¸ªäº‹ä»¶ï¼Œå› ä¸ºæœªæœ‰å‘ç”Ÿï¼Œé‚£ä¹ˆè¯¥äº‹ä»¶çš„ä¿¡æ¯é‡å°±å¤§ã€‚

ä»ä¸Šé¢æ —å­å¯ä»¥çœ‹å‡ºä¿¡æ¯é‡æ˜¯ä¸€ä¸ªä¸äº‹ä»¶å‘ç”Ÿæ¦‚ç‡ç›¸å…³çš„æ¦‚å¿µï¼Œè€Œä¸”å¯ä»¥å¾—å‡ºï¼Œäº‹ä»¶å‘ç”Ÿçš„æ¦‚ç‡è¶Šå°ï¼Œå…¶ä¿¡æ¯é‡è¶Šå¤§ã€‚è¿™ä¹Ÿå¾ˆå¥½ç†è§£ï¼Œå› ä¸ºæ‰€è°“çš„â€œæä¸ªå¤§æ–°é—»â€,ä¹Ÿå°±æ˜¯å‘ç”Ÿäº†ä¸å¤ªå¯èƒ½å‘ç”Ÿçš„äº‹æƒ…ï¼Œ"å¤§æ–°é—»"åˆ™æ„å‘³ç€è¯¥äº‹ä»¶è•´å«ç€æ›´å¤šçš„ä¿¡æ¯ã€‚ä»è¿™ä¸ªè§’åº¦å‡ºå‘ï¼Œ å®šä¹‰ä¿¡æ¯é‡:
> **ä¿¡æ¯é‡:** å‡è®¾$X$æ˜¯ä¸€ä¸ªç¦»æ•£å‹éšæœºå˜é‡ï¼Œå…¶å–å€¼é›†åˆä¸º$\mathcal{X}$ï¼Œå…¶æ¦‚ç‡åˆ†å¸ƒä¸º:
> $$
    p(x) = P(X = x), x \in \mathcal{X}
> $$
> åˆ™å®šä¹‰äº‹ä»¶$X = x_0$çš„ä¿¡æ¯é‡ä¸º:
> $$
    I(x_0) = -\log(p(x_0))
> $$

#### ç†µ 
é¦–å…ˆç»™å‡ºç†µçš„å®šä¹‰ï¼š
> åœ¨ä¿¡æ¯è®ºä¸æ¦‚ç‡ç»Ÿè®¡ä¸­ï¼Œç†µæ˜¯è¡¨ç¤º**éšæœºå˜é‡ä¸ç¡®å®šæ€§**çš„åº¦é‡ï¼Œè®¾$X$æ˜¯ä¸€ä¸ªå–æœ‰é™ä¸ªå€¼çš„ç¦»æ•£éšæœºå˜é‡ï¼Œå…¶æ¦‚ç‡åˆ†å¸ƒä¸º:
> $$
    P(X = x_i) = p_i, \quad i =1,2,\dots,n
> $$
åˆ™éšæœºå˜é‡$X$çš„ç†µå®šä¹‰ä¸º:
$$
    H(X) = - \sum_{i=1}^n p_i \log p_i 
$$

æœ‰äº†ä¿¡æ¯é‡çš„å®šä¹‰åï¼Œå†çœ‹å…³äºç†µçš„å®šä¹‰å¼å¯ä»¥çœ‹å‡ºï¼Œç†µä¸è¿‡æ˜¯åœ¨æ¦‚ç‡åˆ†å¸ƒ$P$ä¸‹å¯¹ä¿¡æ¯é‡æ±‚çš„æœŸæœ›ï¼Œæ‰€ä»¥è¯´ç†µå®é™…ä¸Šå°±æ˜¯**äº‹ä»¶ä¿¡æ¯é‡çš„æœŸæœ›**ã€‚
è‹¥$p_i = 0$,åˆ™å®šä¹‰$0\log 0 =0$,å¼ä¸­çš„å¯¹æ•°ä¸€èˆ¬å–ä»¥2ä¸ºåº•æˆ–è€…ä»¥$e$ä¸ºåº•ï¼Œè¿™æ—¶ç†µçš„å•ä½è¢«ç§°ä½œæ¯”ç‰¹æˆ–çº³ç‰¹ï¼Œç”±å®šä¹‰å¯çŸ¥ï¼Œç†µåªä¾èµ–äº$X$çš„åˆ†å¸ƒï¼Œè€Œä¸$X$çš„å–å€¼æ— å…³ï¼Œå› æ­¤ä¹Ÿå¯å°†$X$çš„ç†µè®°ä½œ$H(p)$,ç†µè¶Šå¤§ï¼Œéšæœºå˜é‡çš„ä¸ç¡®å®šæ€§è¶Šå¤§ã€‚å› ä¸º$p_i \leq 0$,ç”±$H(p)$å‡½æ•°æ€§è´¨(å‡¹å‡½æ•°ï¼Œåº”ç”¨æ‹‰æ ¼æœ—æ—¥ä¹˜å­æ³•å¯æ±‚æœ€å¤§å€¼)å¯çŸ¥:
$$
    0 \leq H(p) \leq \log n
$$

### KLæ•£åº¦(ç›¸å¯¹ç†µ)
KLæ•£åº¦åˆç§°ç›¸å¯¹ç†µï¼Œå¦‚æœæˆ‘ä»¬å¯¹åŒä¸€ä¸ªéšæœºå˜é‡æœ‰ä¸¤ä¸ªç‹¬ç«‹çš„æ¦‚ç‡åˆ†å¸ƒ$P(x)$å’Œ$Q(x)$ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨KLæ•£åº¦æ¥è¡¡é‡è¿™ä¸¤ä¸ªåˆ†å¸ƒçš„å·®å¼‚,ä¸‹é¢ç»™å‡ºKLæ•£åº¦çš„å®šä¹‰å¼:
> åœ¨æœºå™¨å­¦ä¹ ä¸­ï¼Œ$P$å¾€å¾€ç”¨æ¥è¡¨ç¤ºæ ·æœ¬çš„çœŸå®åˆ†å¸ƒï¼Œ$Q$ç”¨æ¥è¡¨ç¤ºæ¨¡å‹æ‰€é¢„æµ‹çš„åˆ†å¸ƒï¼Œé‚£ä¹ˆ$KL$æ•£åº¦å°±å¯ä»¥è®¡ç®—ä¸¤ä¸ªåˆ†å¸ƒä¹‹é—´çš„å·®å¼‚ï¼Œä¹Ÿå°±æ˜¯LossæŸå¤±å€¼:
> $$
    \begin{aligned}
         D_{KL}(P||Q) &= -\sum_{i=1}^n p(x_i) \log(\frac{q(x_i)}{p(x_i)}) \\
            &= -\sum_{i=1}^n p(x_i) \log(q(x_i)) - (-\sum_{i=1}^n p(x_i) \log p(x_i))
    \end{aligned}
> $$
> ç”±äº$-\log x$ä¸ºå‡¸å‡½æ•°ï¼Œç”±å‡¸å‡½æ•°æ€§è´¨å¯çŸ¥:
> $$
     -\sum_{i=1}^n p(x_i) \log(\frac{q(x_i)}{p(x_i)}) \geq  \log \sum_{i=1}^n q(x_i) = 0 
> $$
> è¿™è¯´æ˜KLæ•£åº¦å…·æœ‰éè´Ÿçš„æ€§è´¨ï¼Œè¿™ä¹Ÿè¯´æ˜$P(x)$ä¸å…¶ä»–åˆ†å¸ƒçš„äº¤å‰ç†µæ’å¤§äºç†µã€‚

è¿™é‡Œéœ€è¦è¯´æ˜çš„æ˜¯ï¼Œè™½ç„¶KLæ•£åº¦å…·æœ‰éè´Ÿæ€§ï¼Œä½†å…¶å¹¶ä¸æ»¡è¶³åº¦é‡çš„å¦å¤–ä¸¤ä¸ªæ€§è´¨:
- å¯¹ç§°æ€§
- ä¸‰è§’ä¸ç­‰å¼

### äº¤å‰ç†µ
KLæ•£åº¦ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼Œç¬¬ä¸€éƒ¨åˆ†æ˜¯äº¤å‰ç†µï¼Œç¬¬äºŒéƒ¨åˆ†åˆ™æ˜¯$P(x)$çš„ç†µï¼Œ$P(x)$å› ä¸ºæ˜¯çœŸå®çš„åˆ†å¸ƒï¼Œæ‰€ä»¥å…¶ç†µä¸ºå›ºå®šå€¼ã€‚åœ¨æœºå™¨å­¦ä¹ ä»»åŠ¡ä¸­ï¼Œæˆ‘ä»¬éœ€è¦è¯„ä¼°æ ·æœ¬å›ºæœ‰labelä¸æˆ‘ä»¬ç®—æ³•çš„é¢„æµ‹$predict$ä¹‹é—´çš„å·®è·ï¼Œåœ¨ä¼˜åŒ–è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬åªéœ€å…³æ³¨äº¤å‰ç†µï¼Œæ‰€ä»¥åœ¨åˆ†ç±»ä»»åŠ¡ä¸­ï¼Œå¾€å¾€é‡‡ç”¨äº¤å‰ç†µä½œä¸ºlosså‡½æ•°ã€‚

### JSæ•£åº¦ 
JSæ•£åº¦åªæ˜¯KLæ•£åº¦çš„å˜å½¢ï¼Œå…¶è§£å†³äº†KLæ•£åº¦çš„éå¯¹ç§°é—®é¢˜ï¼Œå…¶è¡¨è¾¾å¼å¦‚ä¸‹:
$$
    JS(P||Q) = \frac{1}{2} KL(P(x)||\frac{P(x) + Q(x)}{2}) + \frac{1}{2}KL(Q(x)||\frac{P(x)+ Q(x)}{2})
$$
è‹¥$\log$ä»¥2ä¸ºåº•ï¼Œåˆ™JSæ•£åº¦çš„èŒƒå›´ä¸º$[0,1]$,è‹¥$\log$ä»¥$e$ä¸ºåº•ï¼Œåˆ™JSæ•£åº¦èŒƒå›´ä¸º$[0,\ln 2]$ã€‚å½“ä¸¤ä¸ªåˆ†å¸ƒå®Œå…¨ç›¸åŒæ—¶å–ä¸‹ç•Œï¼Œå½“ä¸¤ä¸ªåˆ†å¸ƒå®Œå…¨ä¸åŒæ—¶å–ä¸Šç•Œã€‚
è¿™ä¹Ÿå°±å¸¦æ¥äº†ä¸€ä¸ªé—®é¢˜ï¼Œè‹¥ä¼˜åŒ–æ—¶ä¸¤ä¸ªåˆ†å¸ƒå®Œå…¨æ²¡æœ‰äº¤é›†æ—¶,JSæ•£åº¦å°±æ˜¯ä¸€ä¸ªå¸¸æ•°($1$æˆ–$\ln 2$),æ­¤æ—¶ä¼šå‡ºç°æ¢¯åº¦æ¶ˆå¤±é—®é¢˜ï¼Œå¯¼è‡´æ— æ³•è¿›è¡Œä¼˜åŒ–ã€‚

### Wassersteinè·ç¦»
é¦–å…ˆè¯´æ˜ä¸‹KLæ•£åº¦ä¸JSæ•£åº¦å­˜åœ¨çš„é—®é¢˜:
> è‹¥ä¸¤ä¸ªåˆ†å¸ƒ$P,Q$å®Œå…¨æ²¡æœ‰é‡å ï¼Œåˆ™ä¼šå¯¼è‡´KLæ•£åº¦æ— æ„ä¹‰($\log 0$),è€ŒJSæ•£åº¦æ˜¯ä¸€ä¸ªå¸¸æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´å‡ºç°äº†æ¢¯åº¦æ¶ˆå¤±é—®é¢˜ã€‚

è€ŒWassersteinè·ç¦»å¯ä»¥ä¸€å®šç¨‹åº¦ä¸Šè§£å†³è¯¥é—®é¢˜ã€‚
#### æ€æƒ³
å¯¹äºä¸¤ä¸ªåˆ†å¸ƒ$P$å’Œ$Q$ï¼Œè€ƒè™‘ä»å°†ä¸€ä¸ªåˆ†å¸ƒè½¬æ¢æˆå¦ä¸€ä¸ªåˆ†å¸ƒæ‰€éœ€çš„ä»£ä»·å…¥æ‰‹æ¥å®šä¹‰æ¦‚ç‡åˆ†å¸ƒçš„å·®å¼‚ã€‚ä¸‹é¢ä»¥ä¸€ä¸ªæ —å­æ¥è¯´æ˜è¯¥è·ç¦»çš„æ€æƒ³:
> ğŸŒ°: è€ƒè™‘ä¸¤ä¸ªç¦»æ•£åˆ†å¸ƒ$P$å’Œ$Q$:
> $$
    \begin{aligned}
        P_1 &= 3, P_2 = 2, P_3 = 1, P_4 = 4 \\
        Q_1 &= 1, Q_2 = 2, Q_3 = 4, Q_4 = 3 
    \end{aligned}
> $$
> ä¸‹é¢è®¨è®ºåº”è¯¥å¦‚ä½•"ç§»åœŸ"ï¼Œæ‰èƒ½å¤Ÿä½¿å¾—ä¸¤ä¸ªåˆ†å¸ƒç›¸åŒ:
> - ä¸ºäº†è®©$P_1$ä¸$Q_1$ç›¸åŒï¼Œæˆ‘ä»¬éœ€è¦æŠŠ$P_1$çš„3åˆ†2åˆ°$P_2$å»ï¼Œè¿™æ ·$P_1$å’Œ$Q_1$éƒ½ç­‰äº1ï¼Œæ­¤æ—¶$P_2$ç­‰äº4 
> - åŒç†ï¼Œä¸ºäº†è®©$P_2$å’Œ$Q_2$ç›¸åŒï¼Œéœ€è¦å°†$P_2$çš„åœŸå¡«åˆ°$P_3$æ—¶ï¼Œè¿™ä¸€æ­¥å°†ä»$P_2$æŒ–2åˆ†åœŸå¡«åˆ°$P_3$
> - ä¸ºäº†è®©$P_3,Q_3$ç›¸ç­‰ï¼Œæœ€åä¸€æ­¥éœ€è¦å°†$Q_3$çš„1åˆ†åœŸæŒ–ç»™$Q_4$
> æ¯ä¸€æ­¥çš„ä»£ä»·è®¡ç®—å…¬å¼ä¸º$\delta_{i+1} = \delta_i + P_i - Q_i$,ç”±æ­¤å¯å¾—:
> $$
    \begin{aligned}
        \delta_0 &= 0 \\
        \delta_1 &= 0 +3 -1 = 2 \\
        \delta_2 &= 2 + 2 - 2 = 2 \\
        \delta_3 &= 2 + 1 -4 = -1 \\
        \delta_4 &= -1 + 4 - 3 = 0 
    \end{aligned}
> $$
> æ‰€ä»¥æœ€ç»ˆçš„æ€»ä»£ä»·ï¼Œä¹Ÿå°±æ˜¯Wassersteinè·ç¦»ä¸º$W = \sum |\delta_i| = 5$ã€‚è¯¥æ —å­å¯ä»¥å½¢è±¡çš„ç”¨ä¸‹å›¾è¡¨ç¤º:
> ![æ¨åœŸæœºè·ç¦»](https://raw.githubusercontent.com/xuejy19/xuejy19.github.io/source/Img/W_dis.png)

#### å…¬å¼
ä»ä¸Šé¢çš„ç¦»æ•£æ —å­äº†è§£äº†Wassersteinè·ç¦»çš„æ€æƒ³ä¹‹åï¼Œä¸‹é¢ç»™å‡ºä¸€èˆ¬è¿ç»­åˆ†å¸ƒWassersteinè·ç¦»è®¡ç®—å…¬å¼:
> $$
    W(p_r,p_g) = \inf_{\gamma \in \prod(p_r,p_g)} \quad E_{(x,y)\sim \gamma}[||x-y||]
> $$
> å…¬å¼ä¸­$\prod(p_r,p_g)$æŒ‡ä»£$p_r$å’Œ$p_g$æ‰€æœ‰å¯èƒ½çš„è”åˆæ¦‚ç‡åˆ†å¸ƒ$\gamma(x,y)$,ç›´è§‚ä¸Šæ¥è¯´ï¼Œ$\gamma(x,y)$è¡¨ç¤ºå°†åˆ†å¸ƒ$p_r$è½¬åŒ–æˆ$p_g$æ‰€éœ€è¦å¤šå°‘â€œåœŸâ€ï¼ŒWassersteinæŒ‡ä»£èŠ±è´¹æœ€å°‘çš„è¿è¾“æ–¹æ¡ˆã€‚

Wassersteinç›¸å¯¹äºä¼ ç»Ÿçš„KLæ•£åº¦å’ŒJSæ•£è€Œè¨€ï¼Œå½“ä¸¤ä¸ªåˆ†å¸ƒå…·æœ‰å®Œå…¨ä¸åŒçš„æ”¯æ’‘é›†åˆæ—¶ï¼ŒKLæ•£åº¦ä¼šæ˜¯æ— ç©·ï¼ŒJSæ•£åº¦ä¼šæ˜¯ä¸€ä¸ªå¸¸å€¼ï¼Œè€ŒWè·ç¦»æ­¤æ—¶ä»èƒ½åæ˜ ä¸¤ä¸ªåˆ†å¸ƒçš„è¿œè¿‘ã€‚ä¸‹é¢ä»¥ä¸€ä¸ªæ —å­æ¥è¯´æ˜Wassersteinè·ç¦»çš„ä¼˜åŠ¿æ‰€åœ¨:
> ğŸŒ°: å˜é‡$Z \sim U[0,1]$,ä¸‹é¢ç»™å‡ºä¸¤ä¸ªåˆ†å¸ƒ:
> $$
    \begin{aligned}
        &P_0 (x_1), \quad x_1 = (0,Z) \in R^2  \\
        & P_1(x_2), \quad x_2 = (\theta,z) \in R^2
    \end{aligned}
> $$
> å¯¹äºè¿™ä¸ªç®€å•çš„æ —å­ï¼Œä¸åŒæ¦‚ç‡å¯†åº¦è·ç¦»åº¦é‡å¾—åˆ°çš„æ•°å€¼å¦‚ä¸‹:
> $$
    \begin{aligned}
        W(P_0,P_1) &= |\theta| \\ 
        JS(P_0,P_1) &= \begin{cases}
             \log 2  & if \theta \neq 0 \\
             0  & if \theta = 0  
        \end{cases} \\
        KL(P_0||P_1) &= \begin{cases}
             +\infty  & if \theta \neq 0 \\
             0  & if \theta = 0  
        \end{cases}
    \end{aligned}
> $$
> åœ¨Wassersteinåº¦é‡ä¸‹ï¼Œéšç€$\theta_t \rightarrow 0$,æ¦‚ç‡åˆ†å¸ƒåºåˆ—$(P_{\theta_t})_{t \in N}$ æ”¶æ•›åˆ°$P_0$,ä½†åœ¨å…¶ä»–åº¦é‡ä¸‹å¹¶ä¸èƒ½æ”¶æ•›ï¼ŒWè·ç¦»ä¸JSæ•£åº¦åœ¨è¯¥é—®é¢˜ä¸­å¯¹æ¯”å¦‚ä¸‹å›¾æ‰€ç¤º:
> ![$W VS JS$](https://raw.githubusercontent.com/xuejy19/xuejy19.github.io/source/Img/W.png)

#### è®¡ç®—
å°½ç®¡Wassersteinåº¦é‡å…·æœ‰å¾ˆå¤šä¼˜ç‚¹ï¼Œä½†å…¶ç¼ºç‚¹ä¹Ÿååˆ†æ˜æ˜¾ï¼š
> è®¡ç®—éå¸¸å¤æ‚ï¼Œä¼˜åŒ–é—®é¢˜ä¸æ˜“è§£

ç›®å‰èƒ½å¤Ÿæ˜¾ç¤ºè®¡ç®—å‡ºWassersteinçš„åªæœ‰ä¸¤ç§æƒ…å†µï¼š
> ä¸€ç»´æ¦‚ç‡åˆ†å¸ƒ
> é«˜æ–¯åˆ†å¸ƒ 

å¯¹äºä¸¤ä¸ªç¦»æ•£çš„ä¸€ç»´æ¦‚ç‡åˆ†å¸ƒï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨`scipy.stats.Wasserstein_distance`å‡½æ•°:
```python
import numpy as np
from scipy.stats import wasserstein_distance
p = [0,5,9]
q = [2,5,7]
w = wasserstein_distance(q,p)
print(w)
```
è¾“å‡º:
```python
1.3333333333333335 
```

